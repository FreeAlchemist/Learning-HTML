<!DOCTYPE html>
<html>
<head>
	<title>Crossroads Tarot</title>
	<meta charset="UTF-8"/>
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>

<div class="crossroad">
	<div class="crossroad-north" id="crossroad-north">
		<div class="crossroad-card" id="card-north"><!-- ♠ 10 --></div>
	</div>
	<div class="crossroad-west" id="crossroad-west">
		<div class="crossroad-card" id="card-west"><!-- ♥ K --></div>
	</div>
	<div class="crossroad-station" id="crossroad-station">
		<div class="crossroad-card" id="card-station"><!-- ♦ 6 --></div>
	</div>
	<div class="crossroad-east" id="crossroad-east">
		<div class="crossroad-card" id="card-east"><!-- ♣ J --></div>
	</div>
	<div class="crossroad-south" id="crossroad-south">
		<div class="crossroad-card" id="card-south"><b><!-- J --></b></div>
	</div>
</div>

<div class="history"><h3>History</h3>
	<form>
		<div class="stage">
			<div class="title">Name:</div>
			<div class="title"><input id="name" type="text" placeholder="Jack Daw"></div>
		</div>
		<input type="button" value="Random Fate" onclick="randomize()">
	</form>
	<div class="history-block" id="history-station">
	</div>
	<div class="history-block" id="history-west">
	</div>
	<div class="history-block" id="history-north">
	</div>	
	<div class="history-block" id="history-east">
	</div>	
	<div class="history-block" id="history-south">
	</div>	
</div>

<div class="fate"><h3>Fate:</h3>
	<div class="fate-block" id="fate-south">
	</div>
	<div class="fate-block" id="fate-east">
	</div>	
	<div class="fate-block" id="fate-north">
	</div>	
	<div class="fate-block" id="fate-west">
	</div>
	<div class="fate-block" id="fate-station">
	</div>
</div>

<script type="text/javascript" src="js/cardsInterpretation.js"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript">
	var objs = {};
	var arr = [];
	for (var l in interpretation) {
		var key = '' + l;
		for (var v in interpretation[l]) {
			var keyv = key+'_'+v;
			objs[keyv] = interpretation[l][v]
			arr.push(keyv);
		}
	}
/*Random*/
function randomize(){
	arr.sort(function (a, b) {
	  return Math.random() - 0.5;
	});
	$('#history-station').html($('<h2 />',{text:'Station'}))
	.append($('<p />',{text:objs[arr[0]].station.birth}))
	.append($('<p />',{text:objs[arr[0]].station.text}))
	.append($('<p />',{text:'Station skill: '+objs[arr[0]].station.skill}));
	
	$('#history-west').html($('<h2 />',{text:'West (Physical aspects)'})).append($('<p />',{text:objs[arr[1]].west.text}))
	$('#history-north').html($('<h2 />',{text:'North (Main Skills)'})).append($('<p />',{text:objs[arr[2]].north.text}))
	$('#history-east').html($('<h2 />',{text:'East (Mental aspects)'})).append($('<p />',{text:objs[arr[3]].east.text}))
	$('#history-south').html($('<h2 />',{text:'South (Endeavour Skills)'})).append($('<p />',{text:objs[arr[4]].south.text}))
	$('#fate-south')
	.html($('<div />',{class:'fate-title',text:'South Fate: '}))
	.append($('<div />',{text:objs[arr[4]].south.fate}));
	$('#fate-east')
	.html($('<div />',{class:'fate-title',text:'East Fate: '}))
	.append($('<div />',{text:objs[arr[3]].east.fate}));
	$('#fate-north')
	.html($('<div />',{class:'fate-title',text:'North Fate: '}))
	.append($('<div />',{text:objs[arr[2]].north.fate}));
	$('#fate-west')
	.html($('<div />',{class:'fate-title',text:'West Fate: '}))
	.append($('<div />',{text:objs[arr[1]].west.fate}));
	$('#fate-station')
	.html($('<div />',{class:'fate-title',text:'Station Fate: '}))
	.append($('<div />',{text:objs[arr[0]].station.fate}));
	// $('#card-station').html(objs[arr[0]].name)
	// $('#card-west').html(objs[arr[1]].name)
	// $('#card-north').html(objs[arr[2]].name)	
	// $('#card-east').html(objs[arr[3]].name)
	// $('#card-south').html(objs[arr[4]].name)
	$('#card-station').html($('<div />',{class:'crossroad-checked-'+l,text:objs[arr[0]].name}));
	$('#card-west').html($('<div />',{class:'crossroad-checked-'+l,text:objs[arr[1]].name}));
	$('#card-north').html($('<div />',{class:'crossroad-checked-'+l,text:objs[arr[2]].name}));
	$('#card-east').html($('<div />',{class:'crossroad-checked-'+l,text:objs[arr[3]].name}));
	$('#card-south').html($('<div />',{class:'crossroad-checked-'+l,text:objs[arr[4]].name}));
	$('.crossroad-station, .crossroad-west, .crossroad-north, .crossroad-east, .crossroad-south').addClass('checked');
}
/* POPUP */
var $body = $('body');
var $popupWrapper = $('<div />', {class:'popupWrapper notdisplay', click:function(){$(this).addClass('notdisplay')}});
var $popupClose = $('<div />', {class:'popupClose notdisplay', text:'X'});
var $popup = $('<div />', {class:'popup'});
$body.append($popupWrapper);
$popupWrapper.append($popup);
var popupSelectedCard = {
	'crossroad-south' : null,
	'crossroad-east' : null,
	'crossroad-north' : null,
	'crossroad-west' : null,
	'crossroad-station' : null,
}
var popupSelectedDirection = null;
for (var l in interpretation) {
	var key = '' + l;
	var $line =  $('<div />', {class:'popupLine'});
	$popup.append($line);
	for (var v in interpretation[l]) {
		var keyv = key+'_'+v;
		var $obj = $('<div />', {class:'popupCard color'+l, 'data-id':keyv, text:objs[keyv].name, click:clickCard})
		$line.append($obj);
		// objs[keyv].$obj = $obj;
	}
}
$('#crossroad-north').click(function(){
	openCards(this);
})
$('#crossroad-west').click(function(){
	openCards(this);
})
$('#crossroad-station').click(function(){
	openCards(this);
})
$('#crossroad-east').click(function(){
	openCards(this);
})
$('#crossroad-south').click(function(){
	openCards(this);
})
function openCards(derection) {
	popupSelectedDirection = $(derection).attr('id');
	$popupWrapper.removeClass('notdisplay');
}
function clickCard(o) {
	// console.log($(this).attr('data-id'))
	var $this = $(this);
	if ($this.hasClass('catched')) {
		return;
	}
	var card = $(this).attr('data-id');
	// var cardcolor = $(this[class*='color']);
	var cardcolor = $(this).attr('class');
	console.log(cardcolor);
	var classstart = cardcolor.indexOf('color');

	if(classstart != -1){
		console.log("something: "+cardcolor)
		console.log(cardcolor.substr(classstart))
		var classfinish = cardcolor.substr(classstart)
	}

	if (popupSelectedCard[popupSelectedDirection]) {
		$(popupSelectedCard[popupSelectedDirection]).removeClass('catched')
	}
	popupSelectedCard[popupSelectedDirection] = this;
	$(this).addClass('catched');
	$popupWrapper.addClass('notdisplay');
	// alert(card + ' -> ' + popupSelectedDirection);
	// console.log(card + ' -> ' + popupSelectedDirection)
	// console.log(objs[card])
	if(popupSelectedDirection == "crossroad-station"){
		$('#card-station').html($('<div />',{class:classfinish,text:objs[card].name}));
		$('.crossroad-station').addClass('checked');
		$('#history-station')
		.html('<h2>Station</h2>')
		.append($('<p />',{text:objs[card].station.birth}))
		.append($('<p />',{text:objs[card].station.text}))
		.append($('<p />',{text:'Station skill: '+objs[card].station.skill}));
		$('#fate-station')
		.html($('<div />',{class:'fate-title',text:'Station Fate: '}))
		.append($('<div />',{text:objs[card].station.fate}));
	}
	if(popupSelectedDirection == "crossroad-west"){
		$('#card-west').html($('<div />',{class:classfinish,text:objs[card].name}));
		$('.crossroad-west').addClass('checked');
		$('#history-west')
		.html($('<h2 />',{text:'West (Physical aspects)'}))
		.append($('<p />',{text:objs[card].west.text}));
		$('#fate-west')
		.html($('<div />',{class:'fate-title',text:'West Fate: '}))
		.append($('<div />',{text:objs[card].west.fate}));
	}
	if(popupSelectedDirection == "crossroad-north"){
		$('#card-north').html($('<div />',{class:classfinish,text:objs[card].name}));
		$('.crossroad-north').addClass('checked');
		$('#history-north')
		.html($('<h2 />',{text:'North (Main Skills)'}))
		.append($('<p />',{text:objs[card].north.text}));
		$('#fate-north')
		.html($('<div />',{class:'fate-title',text:'North Fate: '}))
		.append($('<div />',{text:objs[card].north.fate}));
	}
	if(popupSelectedDirection == "crossroad-east"){
		$('#card-east').html($('<div />',{class:classfinish,text:objs[card].name}));
		$('.crossroad-east').addClass('checked');
		$('#history-east')
		.html($('<h2 />',{text:'East (Mental aspects)'}))
		.append($('<p />',{text:objs[card].east.text}));
		$('#fate-east')
		.html($('<div />',{class:'fate-title',text:'East Fate: '}))
		.append($('<div />',{text:objs[card].east.fate}));
	}


	var func = function(){
		var obj = {
			south : {
				cardId : '#card-south',
				crossroadClass : '.crossroad-south',
				historyId : '#history-south',
				text1 : 'South (Endeavour Skills)',
				fateId : '#fate-south',
				text2 : 'South Fate: ',
			} 
		}
		return function(dir,classfinish,T0,T1,T2) {
			$(obj[dir].cardId).html($('<div />',{class:classfinish,text:T0}));
			$(obj[dir].crossroadClass).addClass('checked');
			$(obj[dir].historyId)
			.html($('<h2 />',{text:obj[dir].text1}))
			.append($('<p />',{text:T1}));
			$(obj[dir].fateId)
			.html($('<div />',{class:'fate-title',text:obj[dir].text2}))
			.append($('<div />',{text:T2}));
		}
	}()


	if(popupSelectedDirection == "crossroad-south"){
		// $('#card-south').html($('<div />',{class:classfinish,text:objs[card].name}));
		// $('.crossroad-south').addClass('checked');
		// $('#history-south')
		// .html($('<h2 />',{text:'South (Endeavour Skills)'}))
		// .append($('<p />',{text:objs[card].south.text}));
		// $('#fate-south')
		// .html($('<div />',{class:'fate-title',text:'South Fate: '}))
		// .append($('<div />',{text:objs[card].south.fate}));

		func('south',classfinish, objs[card].name,objs[card].south.text,objs[card].south.fate )
	}

}
</script>
</body>
</html>
