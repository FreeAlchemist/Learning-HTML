<!DOCTYPE html>
<html>
<head>
	<title>Crossroads Tarot</title>
	<meta charset="UTF-8"/>
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>

<form id="menu">
<div class="stage">
	<div class="title">Name:</div>
	<div class="title"><input id="name" type="text" placeholder="Jack Daw"></div>
</div>

<input type="button" value="Random" onclick="randomize()">
</form>

<div class="crossroad">
	<div class="crossroad-north" id="crossroad-north">
		<div class="crossroad-card" id="card-north"><!-- ♠ 10 --></div>
	</div>
	<div class="crossroad-west" id="crossroad-west">
		<div class="crossroad-card" id="card-west"><!-- ♥ K --></div>
	</div>
	<div class="crossroad-station" id="crossroad-station">
		<div class="crossroad-card" id="card-station"><!-- ♦ 6 --></div>
	</div>
	<div class="crossroad-east" id="crossroad-east">
		<div class="crossroad-card" id="card-east"><!-- ♣ J --></div>
	</div>
	<div class="crossroad-south" id="crossroad-south">
		<div class="crossroad-card" id="card-south"><b><!-- J --></b></div>
	</div>
</div>

<div class="history">History
	<div class="history-block" id="history-station">
	</div>
	<div class="history-block" id="history-west">
	</div>
	<div class="history-block" id="history-north">
	</div>	
	<div class="history-block" id="history-east">
	</div>	
	<div class="history-block" id="history-south">
	</div>	
</div>

<div class="fate">Fate:
	<div class="fate-block" id="fate-south">
	</div>
	<div class="fate-block" id="fate-east">
	</div>	
	<div class="fate-block" id="fate-north">
	</div>	
	<div class="fate-block" id="fate-west">
	</div>
	<div class="fate-block" id="fate-station">
	</div>
</div>

<script type="text/javascript" src="js/cardsInterpretation.js"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript">

	var objs = {};
	var arr = [];
	for (var l in interpretation) {
		var key = '' + l;
		for (var v in interpretation[l]) {
			var keyv = key+'_'+v;
			objs[keyv] = interpretation[l][v]
			arr.push(keyv);
		}
	}

/*Random*/

function randomize(){
	arr.sort(function (a, b) {
	  return Math.random() - 0.5;
	});
	$('#history-station').html($('<h2 />',{text:'Station'}))
	.append($('<p />',{text:objs[arr[0]].station.birth}))
	.append($('<p />',{text:objs[arr[0]].station.text}))
	.append($('<p />',{text:'Station skill: '+objs[arr[0]].station.skill}));
	
	$('#history-west').html($('<h2 />',{text:'West (Physical aspects)'})).append($('<p />',{text:objs[arr[1]].west.text}))
	$('#history-north').html($('<h2 />',{text:'North (Main Skills)'})).append($('<p />',{text:objs[arr[2]].north.text}))
	$('#history-east').html($('<h2 />',{text:'East (Mental aspects)'})).append($('<p />',{text:objs[arr[3]].east.text}))
	$('#history-south').html($('<h2 />',{text:'South (Endeavour Skills)'})).append($('<p />',{text:objs[arr[4]].south.text}))

	$('#fate-south').html($('<h2 />',{text:'South Fate'})).append($('<p />',{text:objs[arr[4]].south.fate}))
	$('#fate-east').html($('<h2 />',{text:'East Fate'})).append($('<p />',{text:objs[arr[3]].east.fate}))
	$('#fate-north').html($('<h2 />',{text:'North Fate'})).append($('<p />',{text:objs[arr[2]].north.fate}))
	$('#fate-west').html($('<h2 />',{text:'West Fate'})).append($('<p />',{text:objs[arr[1]].west.fate}))
	$('#fate-station').html($('<h2 />',{text:'Station Fate'})).append($('<p />',{text:objs[arr[0]].station.fate}))

	$('#card-station').html(objs[arr[0]].name)
	$('#card-west').html(objs[arr[1]].name)
	$('#card-north').html(objs[arr[2]].name)	
	$('#card-east').html(objs[arr[3]].name)
	$('#card-south').html(objs[arr[4]].name)

	$('.crossroad-station, .crossroad-west, .crossroad-north, .crossroad-east, .crossroad-south').css("background-image","none");
}



/* POPUP */

var $body = $('body');
var $popupWrapper = $('<div />', {class:'popupWrapper notdisplay', click:function(){$(this).addClass('notdisplay')}});
var $popupClose = $('<div />', {class:'popupClose notdisplay', text:'X'});
var $popup = $('<div />', {class:'popup'});
$body.append($popupWrapper);
$popupWrapper.append($popup);

var popupSelectedCard = {
	'crossroad-south' : null,
	'crossroad-east' : null,
	'crossroad-north' : null,
	'crossroad-west' : null,
	'crossroad-station' : null,
}
var popupSelectedDirection = null;

for (var l in interpretation) {
	var key = '' + l;
	var $line =  $('<div />', {class:'popupLine'});
	$popup.append($line);
	for (var v in interpretation[l]) {
		var keyv = key+'_'+v;
		var $obj = $('<div />', {class:'popupCard color'+l, 'data-id':keyv, text:objs[keyv].name, click:clickCard})
		$line.append($obj);
		// objs[keyv].$obj = $obj;
	}
}

$('#crossroad-north').click(function(){
	openCards(this);
})
$('#crossroad-west').click(function(){
	openCards(this);
})
$('#crossroad-station').click(function(){
	openCards(this);
})
$('#crossroad-east').click(function(){
	openCards(this);
})
$('#crossroad-south').click(function(){
	openCards(this);
})

function openCards(derection) {
	popupSelectedDirection = $(derection).attr('id');
	$popupWrapper.removeClass('notdisplay');
}
function clickCard(o) {
	// console.log($(this).attr('data-id'))
	var $this = $(this);
	if ($this.hasClass('catched')) {
		return;
	}
	var card = $(this).attr('data-id');
	if (popupSelectedCard[popupSelectedDirection]) {
		$(popupSelectedCard[popupSelectedDirection]).removeClass('catched')
	}
	popupSelectedCard[popupSelectedDirection] = this;
	$(this).addClass('catched');
	$popupWrapper.addClass('notdisplay');

	// alert(card + ' -> ' + popupSelectedDirection);
	console.log(card + ' -> ' + popupSelectedDirection)
	// console.log(objs[card])

	if(popupSelectedDirection == "crossroad-station"){
		$('#card-station').html(objs[card].name);
		$('.crossroad-station').css("background-image","none");
		$('#history-station')
		.html('<h2>Station</h2>')
		.append($('<p />',{text:objs[card].station.birth}))
		.append($('<p />',{text:objs[card].station.text}))
		.append($('<p />',{text:'Station skill: '+objs[card].station.skill}));
		$('#fate-station')
		// .html($('<h2 />',{text:'Station Fate'}))
		// .append($('<p />',{text:objs[card].station.fate}));
		.html($('<p />',{text:objs[card].station.fate}));
	}
	if(popupSelectedDirection == "crossroad-west"){
		$('#card-west').html(objs[card].name)
		$('.crossroad-west').css("background-image","none");
		$('#history-west')
		.html($('<h2 />',{text:'West (Physical aspects)'}))
		.append($('<p />',{text:objs[card].west.text}));
		$('#fate-west')
		// .html($('<h2 />',{text:'West Fate'}))
		// .append($('<p />',{text:objs[card].west.fate}));
		.html($('<p />',{text:objs[card].west.fate}));
	}
	if(popupSelectedDirection == "crossroad-north"){
		$('#card-north').html(objs[card].name)
		$('.crossroad-north').css("background-image","none");
		$('#history-north')
		.html($('<h2 />',{text:'North (Main Skills)'}))
		.append($('<p />',{text:objs[card].north.text}));
		$('#fate-north')
		// .html($('<h2 />',{text:'North Fate'}))
		// .append($('<p />',{text:objs[card].north.fate}));
		.html($('<p />',{text:objs[card].north.fate}));
	}
	if(popupSelectedDirection == "crossroad-east"){
		$('#card-east').html(objs[card].name)
		$('.crossroad-east').css("background-image","none");
		$('#history-east')
		.html($('<h2 />',{text:'East (Mental aspects)'}))
		.append($('<p />',{text:objs[card].east.text}));
		$('#fate-east')
		// .html($('<h2 />',{text:'East Fate'}))
		// .append($('<p />',{text:objs[card].east.fate}));
		.html($('<p />',{text:objs[card].east.fate}));
	}
	if(popupSelectedDirection == "crossroad-south"){
		$('#card-south').html(objs[card].name)
		$('.crossroad-south').css("background-image","none");
		$('#history-south')
		.html($('<h2 />',{text:'South (Endeavour Skills)'}))
		.append($('<p />',{text:objs[card].south.text}));
		$('#fate-south')
		// .html($('<h2 />',{text:'South Fate'}))
		// .append($('<p />',{text:objs[card].south.fate}));
		.html($('<p />',{text:objs[card].south.fate}));
	}

}

</script>
</body>
</html>
